(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{QQwb:function(e,t,n){"use strict";n.r(t);var r=n("q1tI"),a=n.n(r),s=n("YwZP"),o=n("Bl7J"),c=n("vrFN"),i=n("rxcZ");var l=function(e){var t=e.className,n=void 0===t?"":t,s=e.innerClassName,o=void 0===s?"":s,c=e.uncontainerizeNav,i=void 0!==c&&c,l=e.children;Object(r.useEffect)((function(){if("undefined"!=typeof window){var e=document.querySelector("main");if(e){for(var t=[],n=e.parentElement;null!==n;)t.unshift(n),n=n.parentElement;var r=function(){t[0].style.height="100vh",setTimeout((function(){t[0].scrollHeight>window.innerHeight&&(t[0].style.height=window.innerHeight+"px")}),1)};return r(),window.addEventListener("resize",r),t.slice(1).forEach((function(e){e.classList.add("h-full")})),e.classList.add("relative"),e.style.height="calc(100% - 3.375rem - 1px)",function(){t[0].style.height="initial",window.removeEventListener("resize",r),t.slice(1).forEach((function(e){e.classList.remove("h-full")})),e.classList.remove("relative"),e.style.height="unset"}}}}),[]);var u=Object(r.useRef)();return Object(r.useEffect)((function(){if("undefined"!=typeof window&&i){var e=document.querySelector("nav .container");if(e)return e.classList.remove("container"),function(){e&&e.classList.add("container")}}}),[i]),a.a.createElement("div",{className:"flex flex-col absolute inset-0 "+n,ref:u},a.a.createElement("span",{id:"viewport-log"}),a.a.createElement("div",{className:"flex-1 h-full max-h-full "+o},l))},u=n("o0o1"),m=n.n(u),f=(n("ls82"),n("HaE+")),d=n("G5e0");function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function g(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var h=Object(r.forwardRef)((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,s=e.size,o=void 0===s?24:s,c=g(e,["color","size"]);return a.a.createElement("svg",p({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),a.a.createElement("circle",{cx:"12",cy:"12",r:"3"}),a.a.createElement("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}))}));h.displayName="Settings";var v=h;function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function y(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var x=Object(r.forwardRef)((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,s=e.size,o=void 0===s?24:s,c=y(e,["color","size"]);return a.a.createElement("svg",b({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),a.a.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),a.a.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))}));x.displayName="X";var w=x;function O(){return(O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function E(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var k=Object(r.forwardRef)((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,s=e.size,o=void 0===s?24:s,c=E(e,["color","size"]);return a.a.createElement("svg",O({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),a.a.createElement("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),a.a.createElement("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),a.a.createElement("polyline",{points:"21 15 16 10 5 21"}))}));k.displayName="Image";var j=k;function N(){return(N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function C(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var S=Object(r.forwardRef)((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,s=e.size,o=void 0===s?24:s,c=C(e,["color","size"]);return a.a.createElement("svg",N({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),a.a.createElement("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),a.a.createElement("polygon",{points:"22 2 15 22 11 13 2 9 22 2"}))}));S.displayName="Send";var L=S;function M(e){var t=e.send,n=Object(r.useRef)(null),s=Object(r.useState)(""),o=s[0],c=s[1],i=Object(r.useState)([]),l=i[0],u=i[1],m=function(){(l.length||/[^\s]/.test(o))&&(t(o,l),c(""),u([]),n.current.style.height="auto")};return a.a.createElement("div",null,a.a.createElement("ul",{className:"text-sm"},l.map((function(e,t){return a.a.createElement("li",{key:"attachment-"+t,className:"flex border border-paper-dark mb-1"},a.a.createElement("button",{className:"hover:bg-paper-darker text-pen-light hover:text-pen-lighter p-px mx-1 rounded-full",onClick:function(){return function(e){u(l.filter((function(t){return t!==e})))}(e)}},a.a.createElement(w,{size:16,className:"stroke-current"})),e.name)}))),a.a.createElement("div",{className:"flex items-start"},a.a.createElement("div",{className:"flex-1 relative mr-3"},a.a.createElement("textarea",{className:"w-full resize-none border border-paper-dark bg-paper-darker outline-none placeholder-pen-lighter leading-tight",style:{padding:"0.3125rem"},placeholder:"Type a message...",ref:n,rows:1,value:o,onChange:function(e){e.currentTarget.style.height="auto";var t=Math.min(122,e.currentTarget.scrollHeight);t>24&&(e.currentTarget.style.height=t+2+"px"),c(e.currentTarget.value)},onKeyDown:function(e){"Enter"!==e.key||e.shiftKey||e.ctrlKey||(e.preventDefault(),m())}}),a.a.createElement("div",{className:"absolute h-full right-0 top-0 overflow-hidden"},a.a.createElement("div",{className:"text-pen-light hover:text-pen-lighter relative pt-2 pr-2"},a.a.createElement(j,{size:16,className:"stroke-current"}),a.a.createElement("input",{className:"w-full h-full absolute bottom-0 right-0 opacity-0 cursor-pointer",title:"Add photos",accept:"image/*,video/mp4,video/webm,video/x-matroska,video/quicktime,video/x-flv,video/x-msvideo,video/x-ms-wmv,video/mpeg",type:"file",name:"attachments[]",multiple:!0,onChange:function(e){return u(Array.from(e.currentTarget.files))}})))),a.a.createElement("button",{className:"bg-accent-200 hover:bg-accent text-white p-1 rounded",onClick:m},a.a.createElement(L,{className:"stroke-current"}))))}var T=n("KQm4"),I=n("s4NR"),P=n.n(I),z=function(){function e(e,t){this.url=e,this.ws=null,this.nextKey=1,this.listeners=new Map,this.sendQueue=[],this.connector=t,this.isConnecting=!1}var t=e.prototype;return t.setConnector=function(e){this.connector=e},t.connect=function(){var e=this;this.isConnecting=!0,this.ws=new WebSocket(this.url),this.ws.onmessage=function(t){var n=JSON.parse(t.data);e.listeners.forEach((function(e){e(n)}))},this.ws.onopen=Object(f.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.connector(e);case 2:e.isConnecting=!1,e.send();case 4:case"end":return t.stop()}}),t)})))},t.disconnect=function(){this.isConnecting=!1,this.ws&&(this.ws.close(),this.ws.onopen=this.ws.onmessage=null)},t.addListener=function(e){var t=this.nextKey.toString();return this.nextKey+=1,this.listeners.set(t,e),t},t.removeListener=function(e){this.listeners.delete(e)},t.send=function(e){var t=this,n=Object(T.a)(this.sendQueue);e&&n.push(e),!this.isConnecting&&this.ws&&this.ws.readyState===WebSocket.OPEN?(n.forEach((function(e){return t.ws.send(JSON.stringify(e))})),this.sendQueue=[]):(this.sendQueue.push(e),this.isConnecting||this.connect())},t.sendSync=function(e){this.ws.send(JSON.stringify(e))},t.sendAndListen=function(){var e=Object(f.a)(m.a.mark((function e(t,n){var r,a=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n={}),r=n.returnType||t.action,e.abrupt("return",new Promise((function(e,n){var s=a.addListener((function(t){if(t.type===r)return a.removeListener(s),e(t)}));a.sendSync(t),setTimeout((function(){return n("Timeout waiting for websocket response")}),3e4)})));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e}(),F=n("SHiB"),U=a.a.createContext({token:null,authHttp:null,user:null,userLoading:!1,createGuest:function(){},register:function(){},login:function(){},logout:function(){}});function H(e){var t=Object(r.useState)((function(){return function(e,t){if("undefined"==typeof window)return t;try{var n=localStorage.getItem(e);return null!==n?n:t}catch(r){}return t}("chat/auth_token",null)})),n=t[0],s=t[1],o=Object(r.useState)(null),c=o[0],i=o[1],l=Object(r.useCallback)((function(){s(null),i(null)}),[]),u=Object(r.useCallback)((function(e){return!e.success&&/^Unauthenticated/.test(e.message)&&l(),e}),[l]),d=Object(r.useState)((function(){return new F.a("https://datagame.live")}))[0],p=Object(r.useMemo)((function(){if(!n)return null;var e={"X-Access-Token":n};return new F.a("https://datagame.live",e,[u])}),[u,n]);Object(r.useEffect)((function(){n&&!c&&p.get("/me").then(u).then((function(e){e.success&&i({id:e.userId,username:e.username})}))}),[p,u,n,c]);var g=function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.post("/u",t);case 2:return(n=e.sent).success&&(localStorage.setItem("chat/auth_token",n.token),s(n.token),i({id:n.userId,username:n.username})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(f.a)(m.a.mark((function e(t,n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.post("/login",{username:t,password:n});case 2:return(r=e.sent).success&&(localStorage.setItem("chat/auth_token",r.token),s(r.token),i({id:r.userId,username:r.username})),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return a.a.createElement(U.Provider,{value:{token:n,authHttp:p,user:c,userLoading:n&&!c,createGuest:function(){return g({isGuest:!0})},register:function(e,t){return g({username:e,password:t})},login:h,logout:function(){"undefined"!=typeof window&&localStorage.removeItem("chat/auth_token"),l()}}},e.children)}var R=function(e){var t=Object(r.useState)(!1),n=t[0],a=t[1],s=Object(r.useState)(),o=s[0],c=s[1];return{error:o,loading:n,run:function(){var t=Object(f.a)(m.a.mark((function t(){var n=arguments;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a(!0),c(void 0),t.prev=2,t.next=5,e.apply(void 0,n);case 5:return t.abrupt("return",t.sent);case 8:t.prev=8,t.t0=t.catch(2),c(t.t0);case 11:return t.prev=11,a(!1),t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[2,8,11,14]])})));return function(){return t.apply(this,arguments)}}()}},W=n("Wbzz"),A=a.a.createContext({roomId:null,roomTitle:null,roomUsers:null,nickname:null,isLoading:!1,isConnected:!1,isFirstLogin:!1,setFirstLogin:function(){},sendMessage:function(){},messages:[]});function q(e){var t=e.children,n=s.globalHistory.location,o=Object(r.useContext)(U),c=o.token,i=o.user,l=o.userLoading,u=Object(r.useState)((function(){return P.a.parse(n.search.replace(/^\?/,"")).room}))[0],d=Object(r.useState)(""),p=d[0],g=d[1],h=Object(r.useState)(""),v=h[0],b=h[1],y=Object(r.useState)({}),x=y[0],w=y[1],O=Object(r.useState)(!1),E=O[0],k=O[1],j=Object(r.useState)([]),N=j[0],C=j[1],S=Object(r.useCallback)((function(e){C((function(t){var n=new Map(t.map((function(e,t){return[e.id,t]}))),r=Object(T.a)(t);e.forEach((function(e){var t=n.get(e.id);void 0===t?(r.push(e),n.set(e.id,void 0)):r[t]=e})),C(r)}))}),[]),L=Object(r.useState)(),M=L[0],I=L[1],F=R(Object(r.useCallback)(function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.sendAndListen({action:"login",data:{token:c}});case 2:n=e.sent,I(t),g(n.title),b(n.nickname),k(n.isFirstLogin),t.send({action:"getMessages",data:{}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[c]));Object(r.useEffect)((function(){if(u&&i&&c&&!M&&!F.loading){var e=new z("wss://datagame.live/ws/"+u,F.run),t=e.addListener((function(e){"message"===e.type?S([e.data]):"getMessages"===e.type&&S(e.data)}));return e.connect(),function(){e.disconnect(),e.removeListener(t)}}}),[u,c,l]),Object(r.useEffect)((function(){M&&M.setConnector(F.run)}),[F.run,M]);return Object(r.useEffect)((function(){if(M){var e=M.addListener((function(e){"error"===e.type&&"string"==typeof e.message&&(e.message.startsWith("Unauthenticated")?M.connect():e.message.startsWith("Invalid conversation id")&&Object(W.navigate)("/chat"))}));return function(){M&&M.removeListener(e)}}}),[M]),Object(r.useEffect)((function(){if(M){var e=M.addListener((function(e){if("setNickname"===e.type){var t=e.data,n=t.userId,r=t.nickname;n===i.id&&b(r),w((function(e){var t;return Object.assign({},e,((t={})[n]=Object.assign({},e[n],{nickname:r}),t))})),C((function(e){return e.map((function(e){var t=Object.assign({},e);return t.sender.userId===n&&(t.sender.nickname=r),t}))}))}}));return function(){M&&M.removeListener(e)}}}),[M]),a.a.createElement(A.Provider,{value:{roomId:u,roomTitle:p,roomUsers:x,nickname:v,isLoading:F.loading,isConnected:null!=M,isFirstLogin:E,setFirstLogin:k,sendMessage:function(e){M&&M.send(e)},messages:N}},t)}function D(e){var t=e.from,n=e.content,r=e.isSelf,s=e.isConsecutive;return a.a.createElement("div",{className:r?"chat-message self-end chat-message-mine":"chat-message self-start chat-message-theirs"},!s&&a.a.createElement("label",{className:"mb-1 text-xs text-pen-light"},t),n.text&&a.a.createElement("p",{className:"mb-2 rounded",style:{padding:"0 8px 2px"}},n.text),(n.attachments||[]).map((function(e,t){if("imgur"===e.type){if("img"===e.tag)return a.a.createElement("img",{alt:n.text,className:"mb-2 rounded",src:e.link,key:"msg-attachment-"+t});if("video"===e.tag)return a.a.createElement("video",{className:"mb-2 rounded",src:e.link,key:"msg-attachment-"+t})}return null})))}function G(){var e=Object(r.useContext)(U).user,t=void 0===e?{}:e,n=Object(r.useContext)(A).messages.filter((function(e){return"chat"===e.target&&e.content})).map((function(e,t,n){var r=t>0&&n[t-1].sender.userId===e.sender.userId;return Object.assign({},e,{isConsecutive:r})})),s=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=Object(T.a)(s.current.children);e.length&&e[e.length-1].scrollIntoView()}),[n.length]),a.a.createElement("div",{className:"flex-1 my-2 px-4 overflow-auto"},a.a.createElement("div",{className:"flex min-h-full flex-col justify-end",ref:s},n.map((function(e){return a.a.createElement(D,{key:e.id,content:e.content,from:e.sender.nickname,isSelf:e.sender.userId===t.id,isConsecutive:e.isConsecutive})}))))}var B=n("A0UG");function J(e){var t=e.showModal,n=e.closeModal,s=e.children,o=Object(r.useRef)(null);return a.a.createElement(B.a,{show:t,start:function(){return{opacity:0,dy:-100}},enter:function(){return{opacity:[1],dy:[0]}},leave:function(){return[{opacity:[0]},{dy:[-200],timing:{delay:100}}]}},(function(e){var t=e.opacity,r=e.dy;return a.a.createElement("div",{className:"fixed top-0 left-0 h-full w-full overflow-hidden outline-none",style:{transition:"opacity .1s linear",background:"rgba(0, 0, 0, 0.35)",opacity:t},onClick:function(e){o.current&&!o.current.contains(e.target)&&n()}},a.a.createElement("div",{className:"my-5 px-5 mx-auto max-w-md flex flex-col justify-center items-center h-full"},a.a.createElement("div",{className:"bg-paper-darker rounded card modal-dialog p-4",style:{minWidth:"calc(min(100%, 20rem))",transition:"transform .1s ease-out",transform:"translate(0, "+r+"px)"},ref:o},s)))}))}function K(e){var t=e.showModal,n=e.closeModal,s=Object(r.useContext)(A),o=s.roomId,c=s.nickname,i=s.sendMessage,l=Object(r.useState)(c),u=l[0],m=l[1],f=Object(r.useState)(),d=f[0],p=f[1];Object(r.useEffect)((function(){t&&m(c)}),[t]);return a.a.createElement(J,{showModal:t,closeModal:n},a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),u.length<2||u.length>63?p("Nickname must be 2-63 characters"):/^(\s)*$/.test(u)?p("Nickname can not be all spaces"):(i({action:"setNickname",data:u}),n())}},a.a.createElement("label",{className:"block text-sm text-pen-light",htmlFor:"roomId"},"Room code"),a.a.createElement("div",{className:"mt-2 mb-4",name:"roomId"},o),a.a.createElement("label",{className:"block text-sm text-pen-light",htmlFor:"nickname"},"Nickname"),a.a.createElement("input",{name:"nickname",type:"text",autoComplete:"off",className:"bg-paper-dark rounded p-2 my-1 outline-none",value:u,onChange:function(e){p(void 0),m(e.currentTarget.value)}}),a.a.createElement("div",{className:"flex justify-end mt-3 -mx-1"},a.a.createElement("button",{type:"button",onClick:n,className:"bg-gray-400 hover:bg-gray-500 text-black py-1 px-3 m-1 rounded"},"Cancel"),a.a.createElement("button",{type:"submit",className:"bg-green-500 hover:bg-green-600 text-white py-1 px-3 m-1 rounded"},"Apply"))),d&&a.a.createElement("p",{className:"mt-2 mb-0 text-danger"},d))}function Q(e){var t=e.activeTab,n=e.setActiveTab,r=e.className,s=e.items,o=e.itemClassName,c=e.children;return a.a.createElement("div",null,a.a.createElement("ul",{className:"flex -mx-1"+(r?" "+r:"")},s.map((function(e,r){return a.a.createElement("li",{className:"mx-1 flex-1",key:r},a.a.createElement("button",{className:"inline-block w-full text-center border-accent-200 py-1 px-3 rounded-t"+(o?" "+o:" hover:bg-paper-darker")+(t===r?" border-b":""),onClick:function(){return n(r)}},e))}))),c)}function Y(e){var t=e.closeModal,n=Object(r.useContext)(U),s=n.createGuest,o=n.register,c=Object(r.useState)(!0),i=c[0],l=c[1],u=Object(r.useState)(""),d=u[0],p=u[1],g=Object(r.useState)(""),h=g[0],v=g[1],b=Object(r.useState)(),y=b[0],x=b[1],w=R(Object(f.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=6;break}return e.next=3,s();case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,o(d,h);case 8:n=e.sent;case 9:n.success?t():x(n.message||"Unknown error");case 10:case"end":return e.stop()}}),e)}))));return a.a.createElement("form",{onSubmit:function(e){if(e.preventDefault(),!i){if(d.length<2||d.length>63)return void x("Username must be 2-63 characters");if(/[^A-Za-z0-9-_.]/.test(d))return void x("Username can not contain special characters");if(h.length<8)return void x("Password must be at least 8 characters long")}w.loading||w.run()}},a.a.createElement("input",{className:"mr-2 mt-1 mb-3",type:"checkbox",name:"isGuest",checked:i,onChange:function(e){return l(e.currentTarget.checked)}}),a.a.createElement("label",{className:"inline-block text-sm text-pen-light",htmlFor:"username"},"Use guest account?"),!i&&a.a.createElement(a.a.Fragment,null,a.a.createElement("label",{className:"block text-sm text-pen-light",htmlFor:"username"},"Username"),a.a.createElement("input",{name:"username",type:"text",autoComplete:"off",className:"bg-paper-dark rounded p-2 my-1 outline-none",value:d,onChange:function(e){x(void 0),p(e.currentTarget.value)}}),a.a.createElement("label",{className:"block text-sm text-pen-light",htmlFor:"password"},"Password"),a.a.createElement("input",{name:"password",type:"password",autoComplete:"off",className:"bg-paper-dark rounded p-2 my-1 outline-none",value:h,onChange:function(e){x(void 0),v(e.currentTarget.value)}})),a.a.createElement("div",{className:"flex justify-end mt-3 -mx-1"},a.a.createElement("button",{type:"button",onClick:t,className:"bg-gray-400 hover:bg-gray-500 text-black py-1 px-3 m-1 rounded"},"Cancel"),a.a.createElement("button",{type:"submit",className:"bg-green-500 hover:bg-green-600 text-white py-1 px-3 m-1 rounded"},"Create")),y&&a.a.createElement("p",{className:"mt-2 mb-0 text-danger"},y))}function _(e){var t=e.closeModal,n=Object(r.useContext)(U).login,s=Object(r.useState)(""),o=s[0],c=s[1],i=Object(r.useState)(""),l=i[0],u=i[1],d=Object(r.useState)(),p=d[0],g=d[1],h=R(Object(f.a)(m.a.mark((function e(){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(o,l);case 2:(r=e.sent).success?t():g(r.message||"Unknown error");case 4:case"end":return e.stop()}}),e)}))));return a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),h.loading||h.run()}},a.a.createElement("label",{className:"block text-sm text-pen-light",htmlFor:"username"},"Username"),a.a.createElement("input",{name:"username",type:"text",autoComplete:"off",className:"bg-paper-dark rounded p-2 my-1 outline-none",value:o,onChange:function(e){g(void 0),c(e.currentTarget.value)}}),a.a.createElement("label",{className:"block text-sm text-pen-light",htmlFor:"password"},"Password"),a.a.createElement("input",{name:"password",type:"password",autoComplete:"off",className:"bg-paper-dark rounded p-2 my-1 outline-none",value:l,onChange:function(e){g(void 0),u(e.currentTarget.value)}}),a.a.createElement("div",{className:"flex justify-end mt-3 -mx-1"},a.a.createElement("button",{type:"button",onClick:t,className:"bg-gray-400 hover:bg-gray-500 text-black py-1 px-3 m-1 rounded"},"Cancel"),a.a.createElement("button",{type:"submit",className:"bg-green-500 hover:bg-green-600 text-white py-1 px-3 m-1 rounded"},"Log in")),p&&a.a.createElement("p",{className:"mt-2 mb-0 text-danger"},p))}function V(e){var t=e.showModal,n=e.closeModal,s=e.defaultTab,o=Object(r.useState)(s),c=o[0],i=o[1];return Object(r.useEffect)((function(){t&&i(s)}),[t]),a.a.createElement(J,{showModal:t,closeModal:n},a.a.createElement(Q,{className:"mb-3",itemClassName:"hover:bg-paper-dark",activeTab:c,setActiveTab:i,items:["Register","Log in"]},0===c&&a.a.createElement(Y,{closeModal:n}),1===c&&a.a.createElement(_,{closeModal:n})))}function X(){return(X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Z(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var $=Object(r.forwardRef)((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,s=e.size,o=void 0===s?24:s,c=Z(e,["color","size"]);return a.a.createElement("svg",X({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),a.a.createElement("polyline",{points:"20 6 9 17 4 12"}))}));$.displayName="Check";var ee=$;function te(){return(te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function ne(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var re=Object(r.forwardRef)((function(e,t){var n=e.color,r=void 0===n?"currentColor":n,s=e.size,o=void 0===s?24:s,c=ne(e,["color","size"]);return a.a.createElement("svg",te({ref:t,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),a.a.createElement("polygon",{points:"13 19 22 12 13 5 13 19"}),a.a.createElement("polygon",{points:"2 19 11 12 2 5 2 19"}))}));re.displayName="FastForward";var ae=re,se=n("LvDl"),oe=n("VMuP"),ce=["#5fe984","#67f8f0","#3097f5","#7b82fa"];function ie(e,t){if("setState"===t.type)return Object.assign({},e,t.data);if("reset"===t.type)return{step:0,question:null,series:[],answers:[],progress:null};throw new Error("Unknown action type "+t.type)}var le=function(){var e=Object(r.useContext)(U).user,t=void 0===e?{}:e,n=Object(r.useContext)(A),s=n.isConnected,o=n.messages,c=n.roomUsers,i=n.sendMessage,l=Object(r.useReducer)(ie,{step:0,question:null,series:[],answers:[],progress:null}),u=l[0],m=l[1],f=u.step,d=u.question,p=u.series,g=u.answers,h=u.progress,v=d?d.data.map((function(e){return e.key})):[],b=p.length&&p.length===v.length,y=Object(r.useMemo)((function(){return g.map((function(e,n){var r=(g.length-n-1)%ce.length,a=e.userId===t.id,s=c[e.userId],o=s?s.nickname:e.name;return{name:a?"You":o,showTooltip:!0,stroke:a?"white":ce[r],fill:a?"white":ce[r],series:e.series}}))}),[g,c,t]),x=o.filter((function(e){return e.target.startsWith("guessr")}));Object(r.useEffect)((function(){var e=Object(se.findLastIndex)(x,(function(e){return"guessr:start"===e.target}));if(e>=0){var t=x[e],n=Object(se.findLast)(x.slice(e),(function(e){return"guessr:reveal"===e.target||"guessr:cancel"===e.target}));if(n){if("guessr:cancel"===n.target)m({type:"reset"});else if(Date.now()-n.time<6e5){var r=n.content.result.map((function(e){return Object.assign({},e,{series:e.series.map((function(e,t){return Object.assign({},e,{id:t.toString()})}))})}));m({type:"setState",data:{step:3,question:t.content,progress:null,answers:r,series:[]}})}}else{var a=Object(se.findLast)(x.slice(e),(function(e){return"guessr:progress"===e.target})),s=Object.assign({id:t.id},t.content),o={progress:a?a.content:null};d&&d.id===s.id||(o=Object.assign({},o,{step:1,question:s,series:[],answers:[]})),m({type:"setState",data:o})}}}),[x.length]);if(!s)return null;var w=h&&h.submittedUserIds.includes(t.id)?ee:ae;return a.a.createElement("div",null,a.a.createElement("div",{className:"relative mx-auto",style:{height:"calc(min(40vh, 400px))",width:"calc(min(100%, 540px))"}},f<2&&a.a.createElement("div",{className:"rounded-xl h-full p-3 text-white leading-tight",style:{background:"linear-gradient(45deg, "+oe.b+", "+oe.c+")"}},0===f&&a.a.createElement(a.a.Fragment,null,a.a.createElement("h3",null,"Press the button to begin")),1===f&&a.a.createElement(a.a.Fragment,null,a.a.createElement("h3",null,d.title),a.a.createElement("p",{className:"mb-8"},d.subtitle),d.sources.map((function(e,t){var n=e.format,r=e.url,s=/\[(.+)\]/.exec(n);if(!s)return a.a.createElement("p",{className:"mb-0 text-sm",key:t},n);var o=n.slice(0,s.index),c=n.slice(s.index+s[0].length);return a.a.createElement("p",{className:"mb-0 text-sm",key:t},o,a.a.createElement("a",{className:"hover:underline",style:{color:"#afbfff"},href:r,target:"_blank",rel:"noreferrer"},s[1]),c)})))),f>=2&&a.a.createElement(oe.a,{keys:v,rangeMin:d.yMin,rangeMax:d.yMax,series:p,setSeries:function(e){return m({type:"setState",data:{series:e}})},referenceData:y}),a.a.createElement("div",{className:"absolute bottom-0 right-0 overflow-hidden flex items-center rounded-tl rounded-br-xl opacity-50 hover:opacity-100 bg-gray-900 text-white"},h&&a.a.createElement("span",{className:"cursor-default text-sm px-2"},h.progress+" / "+h.total),a.a.createElement("button",{className:"hover:bg-accent",style:{padding:"0.25rem 12px 0.25rem 8px"},onClick:function(e){0===f||3===f?i({action:"guessr:start",data:{type:"LineGraph"}}):1===f?m({type:"setState",data:{step:2}}):2===f&&b&&i({action:"guessr:submit",data:{series:p}})}},a.a.createElement(w,{size:16})))))};n("qsX1");var ue=function(){var e=Object(r.useContext)(U),t=e.authHttp,n=e.user,s=e.userLoading,o=Object(r.useContext)(A),c=o.isFirstLogin,i=o.setFirstLogin,l=o.roomTitle,u=o.sendMessage,p=Object(r.useState)(!1),g=p[0],h=p[1],b=Object(r.useState)(!1),y=b[0],x=b[1];Object(r.useEffect)((function(){n||s||x(!0)}),[n,s]),Object(r.useEffect)((function(){c&&(h(!0),i(!1))}),[c,i]);var w=function(){var e=Object(f.a)(m.a.mark((function e(n,r){var a,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("/guessr:refresh"!==n){e.next=3;break}return t?t.get("/guessr/q/refresh").then(console.log):console.log("guessr refresh failed - http client not initialized"),e.abrupt("return");case 3:if(a={text:n},!(t&&r&&r.length)){e.next=14;break}return s=new FormData,r.forEach((function(e){s.append("attachments",e)})),e.next=9,t.postForm("/imgur",s);case 9:if((o=e.sent).success){e.next=13;break}return console.error(o.message||"Unknown error"),e.abrupt("return",!1);case 13:a.attachments=o.data.map((function(e){return{type:"imgur",link:e.link,tag:e.type.startsWith("image")?"img":"video"}}));case 14:return u({action:"chat",data:a}),e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return a.a.createElement("div",{className:"flex flex-col h-full pt-4 pb-6"},a.a.createElement("div",{className:"flex items-center border-b pb-2"},a.a.createElement("button",{className:"hover:bg-paper-darker text-accent p-1 mr-3 rounded-full",onClick:function(){Object(W.navigate)("/chat")}},a.a.createElement(d.a,{className:"stroke-current"})),a.a.createElement("h2",{className:"mb-1"},l||"Loading..."),a.a.createElement("span",{className:"flex-grow"}),a.a.createElement("button",{className:"hover:bg-paper-darker p-1 rounded-full",onClick:function(){return h(!0)}},a.a.createElement(v,{className:"stroke-current",size:16}))),a.a.createElement(le,null),a.a.createElement("div",{className:"flex-1 flex flex-col overflow-hidden"},a.a.createElement(G,null),a.a.createElement(M,{send:w})),a.a.createElement(K,{showModal:g,closeModal:function(){return h(!1)}}),a.a.createElement(V,{showModal:y,closeModal:function(){return x(!1)},defaultTab:0}))},me=n("uevz");function fe(){var e=Object(r.useContext)(U).authHttp,t=Object(r.useState)(""),n=t[0],s=t[1],o=Object(r.useState)(""),c=o[0],i=o[1],l=Object(r.useState)(),u=l[0],d=l[1],p=R(function(){var t=Object(f.a)(m.a.mark((function t(n,r){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.post("/g",{title:n,nickname:r});case 4:(a=t.sent).success?Object(W.navigate)("/chat?room="+a.conversationId):d(a.message||"Unknown error");case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());return a.a.createElement("div",null,a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),p.loading||p.run(n,c)},className:"flex flex-wrap -m-1 mt-2"},a.a.createElement("input",{name:"title",placeholder:"Room title",type:"text",autoComplete:"off",className:"w-full sm:w-auto flex-1 bg-paper-darker hover:bg-paper-dark rounded p-2 m-1",value:n,onChange:function(e){d(void 0),s(e.currentTarget.value)}}),a.a.createElement("input",{name:"nickname",placeholder:"Your nickname in the room",type:"text",autoComplete:"off",className:"w-full sm:w-auto flex-1 bg-paper-darker hover:bg-paper-dark rounded p-2 m-1",value:c,onChange:function(e){d(void 0),i(e.currentTarget.value)}}),a.a.createElement("button",{type:"submit",className:"w-full sm:w-auto bg-accent-200 hover:bg-accent text-white py-1 px-3 m-1 rounded"},"Go!")),u&&a.a.createElement("p",{className:"mt-2 mb-0 text-danger"},u))}function de(){var e=Object(r.useState)(""),t=e[0],n=e[1];return a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),Object(W.navigate)("/chat?room="+t)},className:"flex flex-wrap -m-1 mt-2"},a.a.createElement("input",{name:"code",placeholder:"Enter a code",type:"text",autoComplete:"off",className:"w-full sm:w-auto flex-1 bg-paper-darker hover:bg-paper-dark rounded p-2 m-1",value:t,onChange:function(e){return n(e.currentTarget.value)}}),a.a.createElement("button",{type:"submit",className:"w-full sm:w-auto bg-accent-200 hover:bg-accent text-white py-1 px-3 rounded m-1"},"Go!"))}var pe=function(){var e=Object(r.useContext)(U).user,t=Object(r.useState)(0),n=t[0],s=t[1],o=Object(r.useMemo)((function(){return e?["Join","Create"]:["Join"]}),[e]);return a.a.createElement(Q,{activeTab:n,setActiveTab:s,items:o},0===n&&a.a.createElement(de,null),1===n&&a.a.createElement(fe,null))};var ge=function(e){e.handleOpen;var t=Object(r.useContext)(U),n=t.user,s=t.userLoading,o=t.authHttp,c=t.logout,i=Object(r.useState)([]),l=i[0],u=i[1],d=R(Object(r.useCallback)(function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/g");case 2:(n=e.sent).success&&u(n.conversations);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]));Object(r.useEffect)((function(){n&&o&&d.run(o)}),[o,n]);var p=Object(r.useState)([]),g=p[0],h=p[1],v=g.filter((function(e){return l.includes(e)}));v.length<g.length&&h(v);var b=Object(r.useState)(!1),y=b[0],x=b[1],w=Object(r.useState)(0),O=w[0],E=w[1];return a.a.createElement("div",null,a.a.createElement(pe,null),a.a.createElement("div",{className:"flex items-center justify-between border-b border-paper-dark py-2 mt-8"},a.a.createElement("h3",null,"Past rooms"),n&&a.a.createElement("button",{className:"hover:bg-paper-darker text-accent py-1 px-2 mb-1 rounded",onClick:c},a.a.createElement("span",{className:"font-bold text-sm uppercase"},"Log out"))),n||s?a.a.createElement(me.a,{rows:l,columns:[{field:"title",label:"Title",class:"text-left"},{field:"nickname",label:"Your nickname",class:"text-left"}],handleSelect:function(e,t){h([].concat(Object(T.a)(g),[e]).filter((function(n){return t||n!==e})))},handleOpen:function(e){return Object(W.navigate)("/chat?room="+e.id)},keyField:"id"}):a.a.createElement("p",null,"You aren't logged in. You can"," ",a.a.createElement("button",{className:"text-accent hover:text-accent-700 hover:underline",onClick:function(){E(0),x(!0)}},"create a guest account")," ","or"," ",a.a.createElement("button",{className:"text-accent hover:text-accent-700 hover:underline",onClick:function(){E(1),x(!0)}},"sign in")," ","if you have a previous account."),a.a.createElement(V,{showModal:y,closeModal:function(){return x(!1)},defaultTab:O}))};n("kMIJ");function he(){var e=s.globalHistory.location,t=Object(r.useState)(),n=t[0],o=t[1];return Object(r.useEffect)((function(){var t=P.a.parse(e.search.replace(/^\?/,"")).room;o(t)}),[e.search]),"undefined"==typeof window?null:n?a.a.createElement(l,{className:"px-5",innerClassName:"container mx-auto"},a.a.createElement(q,null,a.a.createElement(ue,null))):a.a.createElement(i.a,{className:"px-5 mt-6"},a.a.createElement(ge,null))}t.default=function(e){e.location;return a.a.createElement(o.a,{navLinks:[{text:"Blog",href:"/blog"}],hideFooter:!0},a.a.createElement(c.a,{title:"Chat"}),a.a.createElement(H,null,a.a.createElement(he,null)))}},qsX1:function(e,t,n){}}]);
//# sourceMappingURL=component---src-pages-chat-js-59e6cd016f644f9a18af.js.map