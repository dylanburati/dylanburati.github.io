{"version":3,"sources":["webpack:///./src/components/screenWrapper.js","webpack:///./node_modules/react-feather/dist/icons/settings.js","webpack:///./node_modules/react-feather/dist/icons/x.js","webpack:///./node_modules/react-feather/dist/icons/image.js","webpack:///./node_modules/react-feather/dist/icons/send.js","webpack:///./src/components/chat/chatCompose.js","webpack:///./src/services/wsClient.js","webpack:///./src/components/chat/userContext.js","webpack:///./src/hooks/useAsyncTask.js","webpack:///./src/components/chat/chatContext.js","webpack:///./src/components/chat/chatPanel.js","webpack:///./src/components/modal.js","webpack:///./src/components/chat/chatSettings.js","webpack:///./src/components/tabs.js","webpack:///./src/components/chat/accountModal.js","webpack:///./node_modules/react-feather/dist/icons/check.js","webpack:///./node_modules/react-feather/dist/icons/fast-forward.js","webpack:///./src/components/chat/guessMachine.js","webpack:///./src/components/chat/chat.js","webpack:///./src/components/chat/dashActions.js","webpack:///./src/components/chat/dashboard.js","webpack:///./src/pages/chat.js"],"names":["ScreenWrapper","className","innerClassName","uncontainerizeNav","children","useEffect","window","main","document","querySelector","parentElements","parent","parentElement","unshift","resizeRoot","style","height","setTimeout","scrollHeight","innerHeight","addEventListener","slice","forEach","el","classList","add","removeEventListener","remove","ref","useRef","id","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","Settings","_ref","_ref$color","color","_ref$size","size","rest","createElement","xmlns","width","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","cx","cy","r","d","displayName","X","x1","y1","x2","y2","Image","x","y","rx","ry","points","Send","ChatCompose","send","textareaRef","useState","text","setText","attachments","setAttachments","handleSend","test","current","map","a","onClick","filter","att","removeAttachment","name","padding","placeholder","rows","value","onChange","ev","currentTarget","Math","min","onKeyDown","shiftKey","ctrlKey","preventDefault","title","accept","type","multiple","Array","from","files","WSClient","url","connector","ws","nextKey","listeners","Map","sendQueue","isConnecting","setConnector","connect","WebSocket","onmessage","message","JSON","parse","data","listener","onopen","disconnect","close","addListener","toString","set","removeListener","delete","messages","push","readyState","OPEN","m","stringify","sendSync","sendAndListen","options","listenForType","returnType","action","Promise","resolve","reject","lk","response","UserContext","React","createContext","token","authHttp","user","userLoading","createGuest","register","login","logout","UserProvider","props","dfault","stored","localStorage","getItem","localStorageOrDefault","setToken","setUser","clearUser","useCallback","detect401","json","success","http","HttpClient","useMemo","headers","get","then","userId","username","createUser","input","post","setItem","password","Provider","isGuest","removeItem","useAsyncTask","asyncFn","loading","setLoading","error","setError","run","undefined","ChatContext","roomId","roomTitle","roomUsers","nickname","isLoading","isConnected","isFirstLogin","setFirstLogin","sendMessage","ChatProvider","location","globalHistory","useContext","qs","search","replace","room","setRoomTitle","setNickname","setRoomUsers","setMessages","mergeMessages","toAdd","ids","next","replaceIdx","wsClient","setWsClient","client","msg","nextClient","wsUrl","startsWith","navigate","state","mc","sender","ChatMessage","content","isSelf","isConsecutive","tag","alt","src","link","ChatPanel","chats","arr","panelDiv","array","scrollIntoView","Modal","showModal","closeModal","dialogRef","show","start","opacity","dy","enter","leave","timing","delay","transition","background","contains","minWidth","transform","ChatSettings","inputNickname","setInputNickname","errorMessage","setErrorMessage","onSubmit","htmlFor","autoComplete","Tabs","activeTab","setActiveTab","items","itemClassName","label","idx","RegisterForm","setIsGuest","inputUsername","setInputUsername","setPassword","submit","checked","LoginForm","AccountModal","defaultTab","Check","FastForward","lineColors","reducer","step","question","series","answers","progress","Error","GuessMachine","useReducer","dispatch","e","allPointsDone","referenceData","colorIdx","responder","nick","showTooltip","gameMessages","startIdx","findLastIndex","reveal","findLast","Date","now","time","result","pt","nextQuestion","nextState","Icon","submittedUserIds","includes","gradientColor1","gradientColor2","subtitle","sources","format","linkText","exec","before","index","after","href","rel","rangeMin","yMin","rangeMax","yMax","setSeries","nextSeries","total","Chat","showSettings","setShowSettings","showAccountModal","setShowAccountModal","console","log","formdata","FormData","append","postForm","attachmentLinks","CreateForm","reqTitle","setReqTitle","reqNickname","setReqNickname","create","conversationId","JoinForm","reqCode","setReqCode","DashActions","tabItems","Dashboard","handleOpen","list","setList","getRooms","conversations","selected","setSelected","withoutDeleted","setShowModal","defaultModalTab","setDefaultModalTab","columns","field","class","handleSelect","item","isSelected","keyField","ChatApp","setRoomId","ChatPage","navLinks","hideFooter"],"mappings":"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","file":"component---src-pages-chat-js-59e6cd016f644f9a18af.js","sourcesContent":["import React, { useEffect, useCallback, useRef } from 'react';\n\n// brand size * line height + v padding\nconst navRem = 1.25 * 1.5 + 0.75 * 2;\n\nfunction ScreenWrapper({\n  className = '',\n  innerClassName = '',\n  uncontainerizeNav = false,\n  children,\n}) {\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const main = document.querySelector('main');\n    if (!main) return;\n    const parentElements = [];\n    let parent = main.parentElement;\n    while (parent !== null) {\n      parentElements.unshift(parent);\n      parent = parent.parentElement;\n    }\n    const resizeRoot = () => {\n      parentElements[0].style.height = '100vh';\n      setTimeout(() => {\n        if (parentElements[0].scrollHeight > window.innerHeight) {\n          parentElements[0].style.height = `${window.innerHeight}px`;\n        }\n      }, 1);\n    };\n    resizeRoot();\n    window.addEventListener('resize', resizeRoot);\n    parentElements.slice(1).forEach(el => {\n      el.classList.add('h-full');\n    });\n    main.classList.add('relative');\n    main.style.height = `calc(100% - ${navRem}rem - 1px)`;\n\n    return () => {\n      parentElements[0].style.height = 'initial';\n      window.removeEventListener('resize', resizeRoot);\n      parentElements.slice(1).forEach(el => {\n        el.classList.remove('h-full');\n      });\n      main.classList.remove('relative');\n      main.style.height = 'unset';\n    };\n  }, []);\n  const ref = useRef();\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    if (!uncontainerizeNav) return;\n    const el = document.querySelector('nav .container');\n    if (!el) return;\n\n    el.classList.remove('container');\n    return () => {\n      if (el) el.classList.add('container');\n    };\n  }, [uncontainerizeNav]);\n\n  return (\n    <div className={`flex flex-col absolute inset-0 ${className}`} ref={ref}>\n      <span id=\"viewport-log\"></span>\n      <div className={`flex-1 h-full max-h-full ${innerClassName}`}>\n        {children}\n      </div>\n    </div>\n  );\n}\n\nexport default ScreenWrapper;\n","function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef } from 'react';\nvar Settings = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"circle\", {\n    cx: \"12\",\n    cy: \"12\",\n    r: \"3\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"\n  }));\n});\nSettings.displayName = 'Settings';\nexport default Settings;","function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef } from 'react';\nvar X = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"line\", {\n    x1: \"18\",\n    y1: \"6\",\n    x2: \"6\",\n    y2: \"18\"\n  }), /*#__PURE__*/React.createElement(\"line\", {\n    x1: \"6\",\n    y1: \"6\",\n    x2: \"18\",\n    y2: \"18\"\n  }));\n});\nX.displayName = 'X';\nexport default X;","function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef } from 'react';\nvar Image = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"rect\", {\n    x: \"3\",\n    y: \"3\",\n    width: \"18\",\n    height: \"18\",\n    rx: \"2\",\n    ry: \"2\"\n  }), /*#__PURE__*/React.createElement(\"circle\", {\n    cx: \"8.5\",\n    cy: \"8.5\",\n    r: \"1.5\"\n  }), /*#__PURE__*/React.createElement(\"polyline\", {\n    points: \"21 15 16 10 5 21\"\n  }));\n});\nImage.displayName = 'Image';\nexport default Image;","function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef } from 'react';\nvar Send = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"line\", {\n    x1: \"22\",\n    y1: \"2\",\n    x2: \"11\",\n    y2: \"13\"\n  }), /*#__PURE__*/React.createElement(\"polygon\", {\n    points: \"22 2 15 22 11 13 2 9 22 2\"\n  }));\n});\nSend.displayName = 'Send';\nexport default Send;","import React, { useState, useRef } from 'react';\nimport { Send, Image, X as XIcon } from 'react-feather';\n\nexport function ChatCompose({ send }) {\n  const textareaRef = useRef(null);\n  const [text, setText] = useState('');\n  const [attachments, setAttachments] = useState([]);\n\n  const handleSend = () => {\n    if (attachments.length || /[^\\s]/.test(text)) {\n      send(text, attachments);\n      setText('');\n      setAttachments([]);\n      textareaRef.current.style.height = 'auto';\n    }\n  };\n\n  const removeAttachment = a => {\n    setAttachments(attachments.filter(att => att !== a));\n  };\n\n  return (\n    <div>\n      <ul className=\"text-sm\">\n        {attachments.map((a, i) => (\n          <li\n            key={`attachment-${i}`}\n            className=\"flex border border-paper-dark mb-1\"\n          >\n            <button\n              className=\"hover:bg-paper-darker text-pen-light hover:text-pen-lighter p-px mx-1 rounded-full\"\n              onClick={() => removeAttachment(a)}\n            >\n              <XIcon size={16} className=\"stroke-current\" />\n            </button>\n            {a.name}\n          </li>\n        ))}\n      </ul>\n      <div className=\"flex items-start\">\n        <div className=\"flex-1 relative mr-3\">\n          <textarea\n            className=\"w-full resize-none border border-paper-dark bg-paper-darker outline-none placeholder-pen-lighter leading-tight\"\n            style={{ padding: '0.3125rem' }}\n            placeholder=\"Type a message...\"\n            ref={textareaRef}\n            rows={1}\n            value={text}\n            onChange={ev => {\n              ev.currentTarget.style.height = 'auto';\n              const height = Math.min(122, ev.currentTarget.scrollHeight);\n              if (height > 24) {\n                ev.currentTarget.style.height = `${height + 2}px`;\n              }\n              setText(ev.currentTarget.value);\n            }}\n            onKeyDown={ev => {\n              if (ev.key === 'Enter' && !ev.shiftKey && !ev.ctrlKey) {\n                ev.preventDefault();\n                handleSend();\n              }\n            }}\n          />\n          <div className=\"absolute h-full right-0 top-0 overflow-hidden\">\n            <div className=\"text-pen-light hover:text-pen-lighter relative pt-2 pr-2\">\n              <Image size={16} className=\"stroke-current\" />\n              <input\n                className=\"w-full h-full absolute bottom-0 right-0 opacity-0 cursor-pointer\"\n                title=\"Add photos\"\n                accept=\"image/*,video/mp4,video/webm,video/x-matroska,video/quicktime,video/x-flv,video/x-msvideo,video/x-ms-wmv,video/mpeg\"\n                type=\"file\"\n                name=\"attachments[]\"\n                multiple\n                onChange={ev =>\n                  setAttachments(Array.from(ev.currentTarget.files))\n                }\n              />\n            </div>\n          </div>\n        </div>\n        <button\n          className=\"bg-accent-200 hover:bg-accent text-white p-1 rounded\"\n          onClick={handleSend}\n        >\n          <Send className=\"stroke-current\" />\n        </button>\n      </div>\n    </div>\n  );\n}\n","export default class WSClient {\n  constructor(url, connector) {\n    this.url = url;\n    this.ws = null;\n    this.nextKey = 1;\n    this.listeners = new Map();\n    this.sendQueue = [];\n    this.connector = connector;\n    this.isConnecting = false;\n  }\n\n  setConnector(connector) {\n    this.connector = connector;\n  }\n\n  connect() {\n    this.isConnecting = true;\n    this.ws = new WebSocket(this.url);\n    this.ws.onmessage = ev => {\n      const message = JSON.parse(ev.data);\n      this.listeners.forEach(listener => {\n        listener(message);\n      });\n    };\n    this.ws.onopen = async () => {\n      await this.connector(this);\n      this.isConnecting = false;\n      this.send();\n    };\n  }\n\n  disconnect() {\n    this.isConnecting = false;\n    if (this.ws) {\n      this.ws.close();\n      this.ws.onopen = this.ws.onmessage = null;\n    }\n  }\n\n  addListener(listener) {\n    const key = this.nextKey.toString();\n    this.nextKey += 1;\n    this.listeners.set(key, listener);\n    return key;\n  }\n\n  removeListener(key) {\n    this.listeners.delete(key);\n  }\n\n  send(message) {\n    const messages = [...this.sendQueue];\n    if (message) messages.push(message);\n\n    if (\n      !this.isConnecting &&\n      this.ws &&\n      this.ws.readyState === WebSocket.OPEN\n    ) {\n      messages.forEach(m => this.ws.send(JSON.stringify(m)));\n      this.sendQueue = [];\n    } else {\n      this.sendQueue.push(message);\n      if (!this.isConnecting) {\n        this.connect();\n      }\n    }\n  }\n\n  sendSync(message) {\n    this.ws.send(JSON.stringify(message));\n  }\n\n  /**\n   * @param {any} message Object with action and data for WS server\n   * @param {{ returnType?: string }} options Options\n   */\n  async sendAndListen(message, options = {}) {\n    const listenForType = options.returnType || message.action;\n    return new Promise((resolve, reject) => {\n      const lk = this.addListener(response => {\n        if (response.type === listenForType) {\n          this.removeListener(lk);\n          return resolve(response);\n        }\n      });\n      this.sendSync(message);\n      setTimeout(() => reject('Timeout waiting for websocket response'), 30000);\n    });\n  }\n}\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport HttpClient from '../../services/httpClient';\n\nconst baseUrl = 'https://datagame.live';\nconst tokenStoreKey = 'chat/auth_token';\n\nconst localStorageOrDefault = (key, dfault) => {\n  if (typeof window === 'undefined') return dfault;\n  try {\n    const stored = localStorage.getItem(key);\n    return stored !== null ? stored : dfault;\n  } catch {}\n  return dfault;\n};\n\nexport const UserContext = React.createContext({\n  token: null,\n  authHttp: null,\n  user: null,\n  userLoading: false,\n  createGuest: () => {},\n  register: () => {},\n  login: () => {},\n  logout: () => {},\n});\n\nexport function UserProvider(props) {\n  const [token, setToken] = useState(() =>\n    localStorageOrDefault(tokenStoreKey, null)\n  );\n  const [user, setUser] = useState(null);\n  const clearUser = useCallback(() => {\n    setToken(null);\n    setUser(null);\n  }, []);\n  const detect401 = useCallback(\n    json => {\n      if (!json.success && /^Unauthenticated/.test(json.message)) {\n        clearUser();\n      }\n      return json;\n    },\n    [clearUser]\n  );\n  const [http] = useState(() => new HttpClient(baseUrl));\n  const authHttp = useMemo(() => {\n    if (!token) return null;\n    const headers = {\n      'X-Access-Token': token,\n    };\n    return new HttpClient(baseUrl, headers, [detect401]);\n  }, [detect401, token]);\n  useEffect(() => {\n    if (token && !user) {\n      authHttp\n        .get('/me')\n        .then(detect401)\n        .then(json => {\n          if (json.success) {\n            setUser({ id: json.userId, username: json.username });\n          }\n        });\n    }\n  }, [authHttp, detect401, token, user]);\n\n  const createUser = async input => {\n    const json = await http.post('/u', input);\n    if (json.success) {\n      localStorage.setItem(tokenStoreKey, json.token);\n      setToken(json.token);\n      setUser({ id: json.userId, username: json.username });\n    }\n    return json;\n  };\n  const register = (username, password) => createUser({ username, password });\n  const createGuest = () => createUser({ isGuest: true });\n  const login = async (username, password) => {\n    const json = await http.post('/login', {\n      username,\n      password,\n    });\n    if (json.success) {\n      localStorage.setItem(tokenStoreKey, json.token);\n      setToken(json.token);\n      setUser({ id: json.userId, username: json.username });\n    }\n    return json;\n  };\n  const logout = () => {\n    if (typeof window !== 'undefined') {\n      localStorage.removeItem(tokenStoreKey);\n    }\n    clearUser();\n  };\n\n  return (\n    <UserContext.Provider\n      value={{\n        token,\n        authHttp,\n        user,\n        userLoading: token && !user,\n        createGuest,\n        register,\n        login,\n        logout,\n      }}\n    >\n      {props.children}\n    </UserContext.Provider>\n  );\n}\n","import { useState } from 'react';\n\n/**\n * Returns the function along with info about the most recent call\n *\n * @param {(...args: any[]) => Promise<any>} asyncFn\n */\nexport const useAsyncTask = asyncFn => {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState();\n\n  const run = async (...args) => {\n    setLoading(true);\n    setError(undefined);\n    try {\n      return await asyncFn(...args);\n    } catch (err) {\n      setError(err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return {\n    error,\n    loading,\n    run,\n  };\n};\n","import React, { useState, useEffect, useContext, useCallback } from 'react';\nimport { globalHistory } from '@reach/router';\nimport qs from 'querystring';\nimport WSClient from '../../services/wsClient';\nimport { UserContext } from './userContext';\nimport { useAsyncTask } from '../../hooks/useAsyncTask';\nimport { navigate } from 'gatsby';\n\nexport const ChatContext = React.createContext({\n  roomId: null,\n  roomTitle: null,\n  roomUsers: null,\n  nickname: null,\n  isLoading: false,\n  isConnected: false,\n  isFirstLogin: false,\n  setFirstLogin: () => {},\n  sendMessage: () => {},\n  messages: [],\n});\n\nconst wsUrl = 'wss://datagame.live/ws';\nexport function ChatProvider({ children }) {\n  const { location } = globalHistory;\n  const { token, user, userLoading } = useContext(UserContext);\n  const [roomId] = useState(() => {\n    const { room } = qs.parse(location.search.replace(/^\\?/, ''));\n    return room;\n  });\n  const [roomTitle, setRoomTitle] = useState('');\n  const [nickname, setNickname] = useState('');\n  const [roomUsers, setRoomUsers] = useState({});\n  const [isFirstLogin, setFirstLogin] = useState(false);\n  const [messages, setMessages] = useState([]);\n\n  const mergeMessages = useCallback(toAdd => {\n    setMessages(messages => {\n      const ids = new Map(messages.map((m, i) => [m.id, i]));\n      const next = [...messages];\n      toAdd.forEach(m => {\n        const replaceIdx = ids.get(m.id);\n        if (replaceIdx === undefined) {\n          next.push(m);\n          ids.set(m.id, undefined);\n        } else {\n          next[replaceIdx] = m;\n        }\n      });\n      setMessages(next);\n    });\n  }, []);\n\n  const [wsClient, setWsClient] = useState();\n  const connect = useAsyncTask(\n    useCallback(\n      async client => {\n        const msg = await client.sendAndListen({\n          action: 'login',\n          data: { token },\n        });\n        setWsClient(client);\n        setRoomTitle(msg.title);\n        setNickname(msg.nickname);\n        setFirstLogin(msg.isFirstLogin);\n        client.send({\n          action: 'getMessages',\n          data: {},\n        });\n      },\n      [token]\n    )\n  );\n  useEffect(() => {\n    if (roomId && user && token && !wsClient && !connect.loading) {\n      const nextClient = new WSClient(`${wsUrl}/${roomId}`, connect.run);\n      const lk = nextClient.addListener(message => {\n        if (message.type === 'message') {\n          mergeMessages([message.data]);\n        } else if (message.type === 'getMessages') {\n          mergeMessages(message.data);\n        }\n      });\n      nextClient.connect();\n\n      return () => {\n        nextClient.disconnect();\n        nextClient.removeListener(lk);\n      };\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [roomId, token, userLoading]);\n  useEffect(() => {\n    if (wsClient) wsClient.setConnector(connect.run);\n  }, [connect.run, wsClient]);\n\n  const sendMessage = m => {\n    if (wsClient) wsClient.send(m);\n  };\n\n  useEffect(() => {\n    if (!wsClient) return;\n\n    const lk = wsClient.addListener(message => {\n      if (message.type === 'error') {\n        if (typeof message.message === 'string') {\n          if (message.message.startsWith('Unauthenticated')) wsClient.connect();\n          else if (message.message.startsWith('Invalid conversation id'))\n            navigate('/chat');\n        }\n      }\n    });\n\n    return () => {\n      if (wsClient) wsClient.removeListener(lk);\n    };\n  }, [wsClient]);\n  useEffect(() => {\n    if (!wsClient) return;\n\n    const lk = wsClient.addListener(message => {\n      if (message.type === 'setNickname') {\n        const { userId, nickname } = message.data;\n        if (userId === user.id) {\n          setNickname(nickname);\n        }\n        setRoomUsers(state => ({\n          ...state,\n          [userId]: {\n            ...state[userId],\n            nickname,\n          },\n        }));\n        setMessages(messages =>\n          messages.map(m => {\n            const mc = { ...m };\n            if (mc.sender.userId === userId) mc.sender.nickname = nickname;\n            return mc;\n          })\n        );\n      }\n    });\n\n    return () => {\n      if (wsClient) wsClient.removeListener(lk);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [wsClient]);\n\n  return (\n    <ChatContext.Provider\n      value={{\n        roomId,\n        roomTitle,\n        roomUsers,\n        nickname,\n        isLoading: connect.loading,\n        isConnected: wsClient != null,\n        isFirstLogin,\n        setFirstLogin,\n        sendMessage,\n        messages,\n      }}\n    >\n      {children}\n    </ChatContext.Provider>\n  );\n}\n","import React, { useEffect, useRef, useContext } from 'react';\nimport { ChatContext } from './chatContext';\nimport { UserContext } from './userContext';\n\nfunction ChatMessage({ from, content, isSelf, isConsecutive }) {\n  return (\n    <div\n      className={\n        isSelf\n          ? 'chat-message self-end chat-message-mine'\n          : 'chat-message self-start chat-message-theirs'\n      }\n    >\n      {!isConsecutive && (\n        <label className=\"mb-1 text-xs text-pen-light\">{from}</label>\n      )}\n      {content.text && (\n        <p className=\"mb-2 rounded\" style={{ padding: '0 8px 2px' }}>\n          {content.text}\n        </p>\n      )}\n      {(content.attachments || []).map((att, i) => {\n        if (att.type === 'imgur') {\n          if (att.tag === 'img')\n            return (\n              <img\n                alt={content.text}\n                className=\"mb-2 rounded\"\n                src={att.link}\n                key={`msg-attachment-${i}`}\n              />\n            );\n          if (att.tag === 'video')\n            return (\n              <video\n                className=\"mb-2 rounded\"\n                src={att.link}\n                key={`msg-attachment-${i}`}\n              />\n            );\n        }\n        return null;\n      })}\n    </div>\n  );\n}\n\nexport function ChatPanel() {\n  const { user = {} } = useContext(UserContext);\n  const { messages } = useContext(ChatContext);\n\n  const chats = messages\n    .filter(m => m.target === 'chat' && m.content)\n    .map((m, i, arr) => {\n      const isConsecutive =\n        i > 0 && arr[i - 1].sender.userId === m.sender.userId;\n      return { ...m, isConsecutive };\n    });\n\n  const panelDiv = useRef(null);\n  useEffect(() => {\n    const array = [...panelDiv.current.children];\n    if (array.length) array[array.length - 1].scrollIntoView();\n  }, [chats.length]);\n\n  return (\n    <div className=\"flex-1 my-2 px-4 overflow-auto\">\n      <div className=\"flex min-h-full flex-col justify-end\" ref={panelDiv}>\n        {chats.map(m => (\n          <ChatMessage\n            key={m.id}\n            content={m.content}\n            from={m.sender.nickname}\n            isSelf={m.sender.userId === user.id}\n            isConsecutive={m.isConsecutive}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n","import React, { useRef } from 'react';\nimport { Animate } from 'react-move';\n\nexport function Modal({ showModal, closeModal, children }) {\n  const dialogRef = useRef(null);\n\n  return (\n    <Animate\n      show={showModal}\n      start={() => ({ opacity: 0, dy: -100 })}\n      enter={() => ({ opacity: [1], dy: [0] })}\n      leave={() => [{ opacity: [0] }, { dy: [-200], timing: { delay: 100 } }]}\n    >\n      {({ opacity, dy }) => (\n        <div\n          className=\"fixed top-0 left-0 h-full w-full overflow-hidden outline-none\"\n          style={{\n            transition: 'opacity .1s linear',\n            background: `rgba(0, 0, 0, 0.35)`,\n            opacity: opacity,\n          }}\n          onClick={ev => {\n            if (dialogRef.current && !dialogRef.current.contains(ev.target)) {\n              closeModal();\n            }\n          }}\n        >\n          <div className=\"my-5 px-5 mx-auto max-w-md flex flex-col justify-center items-center h-full\">\n            <div\n              className=\"bg-paper-darker rounded card modal-dialog p-4\"\n              style={{\n                minWidth: `calc(min(100%, 20rem))`,\n                transition: 'transform .1s ease-out',\n                transform: `translate(0, ${dy}px)`,\n              }}\n              ref={dialogRef}\n            >\n              {children}\n            </div>\n          </div>\n        </div>\n      )}\n    </Animate>\n  );\n}\n","import React, { useContext, useEffect, useState } from 'react';\nimport { Modal } from '../modal';\nimport { ChatContext } from './chatContext';\n\nexport function ChatSettings({ showModal, closeModal }) {\n  const { roomId, nickname, sendMessage } = useContext(ChatContext);\n  const [inputNickname, setInputNickname] = useState(nickname);\n  const [errorMessage, setErrorMessage] = useState();\n  useEffect(() => {\n    if (showModal) setInputNickname(nickname);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showModal]);\n\n  const handleSubmit = ev => {\n    ev.preventDefault();\n    if (inputNickname.length < 2 || inputNickname.length > 63) {\n      setErrorMessage('Nickname must be 2-63 characters');\n      return;\n    }\n    if (/^(\\s)*$/.test(inputNickname)) {\n      setErrorMessage('Nickname can not be all spaces');\n      return;\n    }\n    sendMessage({ action: 'setNickname', data: inputNickname });\n    closeModal();\n  };\n  return (\n    <Modal showModal={showModal} closeModal={closeModal}>\n      <form onSubmit={handleSubmit}>\n        <label className=\"block text-sm text-pen-light\" htmlFor=\"roomId\">\n          Room code\n        </label>\n        <div className=\"mt-2 mb-4\" name=\"roomId\">\n          {roomId}\n        </div>\n        <label className=\"block text-sm text-pen-light\" htmlFor=\"nickname\">\n          Nickname\n        </label>\n        <input\n          name=\"nickname\"\n          type=\"text\"\n          autoComplete=\"off\"\n          className=\"bg-paper-dark rounded p-2 my-1 outline-none\"\n          value={inputNickname}\n          onChange={ev => {\n            setErrorMessage(undefined);\n            setInputNickname(ev.currentTarget.value);\n          }}\n        />\n        <div className=\"flex justify-end mt-3 -mx-1\">\n          <button\n            type=\"button\"\n            onClick={closeModal}\n            className=\"bg-gray-400 hover:bg-gray-500 text-black py-1 px-3 m-1 rounded\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            className=\"bg-green-500 hover:bg-green-600 text-white py-1 px-3 m-1 rounded\"\n          >\n            Apply\n          </button>\n        </div>\n      </form>\n      {errorMessage && <p className=\"mt-2 mb-0 text-danger\">{errorMessage}</p>}\n    </Modal>\n  );\n}\n","import React from 'react';\n\nexport function Tabs({\n  activeTab,\n  setActiveTab,\n  className,\n  items,\n  itemClassName,\n  children,\n}) {\n  return (\n    <div>\n      <ul className={'flex -mx-1' + (className ? ` ${className}` : '')}>\n        {items.map((label, idx) => (\n          <li className=\"mx-1 flex-1\" key={idx}>\n            <button\n              className={\n                'inline-block w-full text-center border-accent-200 py-1 px-3 rounded-t' +\n                (itemClassName\n                  ? ` ${itemClassName}`\n                  : ' hover:bg-paper-darker') +\n                (activeTab === idx ? ' border-b' : '')\n              }\n              onClick={() => setActiveTab(idx)}\n            >\n              {label}\n            </button>\n          </li>\n        ))}\n      </ul>\n      {children}\n    </div>\n  );\n}\n","import React, { useContext, useEffect, useState } from 'react';\nimport { Modal } from '../modal';\nimport { UserContext } from './userContext';\nimport { Tabs } from '../tabs';\nimport { useAsyncTask } from '../../hooks/useAsyncTask';\n\nexport function RegisterForm({ closeModal }) {\n  const { createGuest, register } = useContext(UserContext);\n\n  const [isGuest, setIsGuest] = useState(true);\n  const [inputUsername, setInputUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [errorMessage, setErrorMessage] = useState();\n\n  const submit = useAsyncTask(async () => {\n    let json;\n    if (isGuest) {\n      json = await createGuest();\n    } else {\n      json = await register(inputUsername, password);\n    }\n\n    if (json.success) closeModal();\n    else setErrorMessage(json.message || 'Unknown error');\n  });\n  const handleSubmit = ev => {\n    ev.preventDefault();\n    if (!isGuest) {\n      if (inputUsername.length < 2 || inputUsername.length > 63) {\n        setErrorMessage('Username must be 2-63 characters');\n        return;\n      }\n      if (/[^A-Za-z0-9-_.]/.test(inputUsername)) {\n        setErrorMessage('Username can not contain special characters');\n        return;\n      }\n      if (password.length < 8) {\n        setErrorMessage('Password must be at least 8 characters long');\n        return;\n      }\n    }\n\n    if (!submit.loading) submit.run();\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <input\n        className=\"mr-2 mt-1 mb-3\"\n        type=\"checkbox\"\n        name=\"isGuest\"\n        checked={isGuest}\n        onChange={ev => setIsGuest(ev.currentTarget.checked)}\n      />\n      <label className=\"inline-block text-sm text-pen-light\" htmlFor=\"username\">\n        Use guest account?\n      </label>\n      {!isGuest && (\n        <>\n          <label className=\"block text-sm text-pen-light\" htmlFor=\"username\">\n            Username\n          </label>\n          <input\n            name=\"username\"\n            type=\"text\"\n            autoComplete=\"off\"\n            className=\"bg-paper-dark rounded p-2 my-1 outline-none\"\n            value={inputUsername}\n            onChange={ev => {\n              setErrorMessage(undefined);\n              setInputUsername(ev.currentTarget.value);\n            }}\n          />\n          <label className=\"block text-sm text-pen-light\" htmlFor=\"password\">\n            Password\n          </label>\n          <input\n            name=\"password\"\n            type=\"password\"\n            autoComplete=\"off\"\n            className=\"bg-paper-dark rounded p-2 my-1 outline-none\"\n            value={password}\n            onChange={ev => {\n              setErrorMessage(undefined);\n              setPassword(ev.currentTarget.value);\n            }}\n          />\n        </>\n      )}\n      <div className=\"flex justify-end mt-3 -mx-1\">\n        <button\n          type=\"button\"\n          onClick={closeModal}\n          className=\"bg-gray-400 hover:bg-gray-500 text-black py-1 px-3 m-1 rounded\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"submit\"\n          className=\"bg-green-500 hover:bg-green-600 text-white py-1 px-3 m-1 rounded\"\n        >\n          Create\n        </button>\n      </div>\n      {errorMessage && <p className=\"mt-2 mb-0 text-danger\">{errorMessage}</p>}\n    </form>\n  );\n}\n\nexport function LoginForm({ closeModal }) {\n  const { login } = useContext(UserContext);\n  const [inputUsername, setInputUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [errorMessage, setErrorMessage] = useState();\n\n  const submit = useAsyncTask(async () => {\n    const json = await login(inputUsername, password);\n    if (json.success) closeModal();\n    else setErrorMessage(json.message || 'Unknown error');\n  });\n  const handleSubmit = ev => {\n    ev.preventDefault();\n    if (!submit.loading) submit.run();\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <label className=\"block text-sm text-pen-light\" htmlFor=\"username\">\n        Username\n      </label>\n      <input\n        name=\"username\"\n        type=\"text\"\n        autoComplete=\"off\"\n        className=\"bg-paper-dark rounded p-2 my-1 outline-none\"\n        value={inputUsername}\n        onChange={ev => {\n          setErrorMessage(undefined);\n          setInputUsername(ev.currentTarget.value);\n        }}\n      />\n      <label className=\"block text-sm text-pen-light\" htmlFor=\"password\">\n        Password\n      </label>\n      <input\n        name=\"password\"\n        type=\"password\"\n        autoComplete=\"off\"\n        className=\"bg-paper-dark rounded p-2 my-1 outline-none\"\n        value={password}\n        onChange={ev => {\n          setErrorMessage(undefined);\n          setPassword(ev.currentTarget.value);\n        }}\n      />\n      <div className=\"flex justify-end mt-3 -mx-1\">\n        <button\n          type=\"button\"\n          onClick={closeModal}\n          className=\"bg-gray-400 hover:bg-gray-500 text-black py-1 px-3 m-1 rounded\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"submit\"\n          className=\"bg-green-500 hover:bg-green-600 text-white py-1 px-3 m-1 rounded\"\n        >\n          Log in\n        </button>\n      </div>\n      {errorMessage && <p className=\"mt-2 mb-0 text-danger\">{errorMessage}</p>}\n    </form>\n  );\n}\n\nexport function AccountModal({ showModal, closeModal, defaultTab }) {\n  const [activeTab, setActiveTab] = useState(defaultTab);\n  useEffect(() => {\n    if (showModal) setActiveTab(defaultTab);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [showModal]);\n  return (\n    <Modal showModal={showModal} closeModal={closeModal}>\n      <Tabs\n        className=\"mb-3\"\n        itemClassName=\"hover:bg-paper-dark\"\n        activeTab={activeTab}\n        setActiveTab={setActiveTab}\n        items={['Register', 'Log in']}\n      >\n        {activeTab === 0 && <RegisterForm closeModal={closeModal} />}\n        {activeTab === 1 && <LoginForm closeModal={closeModal} />}\n      </Tabs>\n    </Modal>\n  );\n}\n","function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef } from 'react';\nvar Check = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"polyline\", {\n    points: \"20 6 9 17 4 12\"\n  }));\n});\nCheck.displayName = 'Check';\nexport default Check;","function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport React, { forwardRef } from 'react';\nvar FastForward = forwardRef(function (_ref, ref) {\n  var _ref$color = _ref.color,\n      color = _ref$color === void 0 ? 'currentColor' : _ref$color,\n      _ref$size = _ref.size,\n      size = _ref$size === void 0 ? 24 : _ref$size,\n      rest = _objectWithoutProperties(_ref, [\"color\", \"size\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    ref: ref,\n    xmlns: \"http://www.w3.org/2000/svg\",\n    width: size,\n    height: size,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    stroke: color,\n    strokeWidth: \"2\",\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\"\n  }, rest), /*#__PURE__*/React.createElement(\"polygon\", {\n    points: \"13 19 22 12 13 5 13 19\"\n  }), /*#__PURE__*/React.createElement(\"polygon\", {\n    points: \"2 19 11 12 2 5 2 19\"\n  }));\n});\nFastForward.displayName = 'FastForward';\nexport default FastForward;","import React, { useReducer, useContext, useMemo, useEffect } from 'react';\nimport { Check, FastForward } from 'react-feather';\nimport { findLast, findLastIndex } from 'lodash';\nimport { ChatContext } from './chatContext';\nimport { UserContext } from './userContext';\nimport LineGraphContainer, {\n  gradientColor1,\n  gradientColor2,\n} from '../guessr/lineGraphContainer';\n\nexport const lineColors = ['#5fe984', '#67f8f0', '#3097f5', '#7b82fa'];\n\nconst initialState = () => ({\n  step: 0,\n  question: null,\n  series: [],\n  answers: [],\n  progress: null,\n});\n\nfunction reducer(state, action) {\n  if (action.type === 'setState') {\n    return { ...state, ...action.data };\n  } else if (action.type === 'reset') {\n    return initialState();\n  } else {\n    throw new Error(`Unknown action type ${action.type}`);\n  }\n}\n\nconst GuessMachine = () => {\n  const { user = {} } = useContext(UserContext);\n  const { isConnected, messages, roomUsers, sendMessage } = useContext(\n    ChatContext\n  );\n\n  // 0 = waiting, 1 = title, 2 = graph, 3 = result\n  const [state, dispatch] = useReducer(reducer, initialState());\n  const { step, question, series, answers, progress } = state;\n\n  const keys = question ? question.data.map(e => e.key) : [];\n  const allPointsDone = series.length && series.length === keys.length;\n\n  const referenceData = useMemo(() => {\n    return answers.map((a, i) => {\n      const colorIdx = (answers.length - i - 1) % lineColors.length;\n      const isSelf = a.userId === user.id;\n      const responder = roomUsers[a.userId];\n      const nick = responder ? responder.nickname : a.name;\n      return {\n        name: isSelf ? 'You' : nick,\n        showTooltip: true,\n        stroke: isSelf ? 'white' : lineColors[colorIdx],\n        fill: isSelf ? 'white' : lineColors[colorIdx],\n        series: a.series,\n      };\n    });\n  }, [answers, roomUsers, user]);\n\n  const gameMessages = messages.filter(m => m.target.startsWith('guessr'));\n  useEffect(() => {\n    const startIdx = findLastIndex(\n      gameMessages,\n      m => m.target === 'guessr:start'\n    );\n    if (startIdx >= 0) {\n      const start = gameMessages[startIdx];\n      const reveal = findLast(\n        gameMessages.slice(startIdx),\n        m => m.target === 'guessr:reveal' || m.target === 'guessr:cancel'\n      );\n      if (reveal) {\n        if (reveal.target === 'guessr:cancel') {\n          dispatch({ type: 'reset' });\n        } else if (Date.now() - reveal.time < 10 * 60 * 1000) {\n          const answers = reveal.content.result.map(a => ({\n            ...a,\n            series: a.series.map((pt, i) => ({ ...pt, id: i.toString() })),\n          }));\n          dispatch({\n            type: 'setState',\n            data: {\n              step: 3,\n              question: start.content,\n              progress: null,\n              answers: answers,\n              series: [],\n            },\n          });\n        }\n      } else {\n        const progress = findLast(\n          gameMessages.slice(startIdx),\n          m => m.target === 'guessr:progress'\n        );\n        const nextQuestion = { id: start.id, ...start.content };\n        let nextState = {\n          progress: progress ? progress.content : null,\n        };\n        if (!question || question.id !== nextQuestion.id) {\n          nextState = {\n            ...nextState,\n            step: 1,\n            question: nextQuestion,\n            series: [],\n            answers: [],\n          };\n        }\n        dispatch({\n          type: 'setState',\n          data: nextState,\n        });\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [gameMessages.length]);\n\n  const handleForward = ev => {\n    if (step === 0 || step === 3) {\n      sendMessage({ action: 'guessr:start', data: { type: 'LineGraph' } });\n    } else if (step === 1) {\n      dispatch({ type: 'setState', data: { step: 2 } });\n    } else if (step === 2 && allPointsDone) {\n      sendMessage({ action: 'guessr:submit', data: { series } });\n    }\n  };\n\n  if (!isConnected) return null;\n\n  const Icon =\n    progress && progress.submittedUserIds.includes(user.id)\n      ? Check\n      : FastForward;\n  return (\n    <div>\n      <div\n        className=\"relative mx-auto\"\n        style={{\n          height: 'calc(min(40vh, 400px))',\n          width: 'calc(min(100%, 540px))',\n        }}\n      >\n        {step < 2 && (\n          <div\n            className=\"rounded-xl h-full p-3 text-white leading-tight\"\n            style={{\n              background: `linear-gradient(45deg, ${gradientColor1}, ${gradientColor2})`,\n            }}\n          >\n            {step === 0 && (\n              <>\n                <h3>Press the button to begin</h3>\n              </>\n            )}\n            {step === 1 && (\n              <>\n                <h3>{question.title}</h3>\n                <p className=\"mb-8\">{question.subtitle}</p>\n                {question.sources.map(({ format, url }, idx) => {\n                  const linkText = /\\[(.+)\\]/.exec(format);\n                  if (!linkText) {\n                    return (\n                      <p className=\"mb-0 text-sm\" key={idx}>\n                        {format}\n                      </p>\n                    );\n                  }\n\n                  const before = format.slice(0, linkText.index);\n                  const after = format.slice(\n                    linkText.index + linkText[0].length\n                  );\n                  return (\n                    <p className=\"mb-0 text-sm\" key={idx}>\n                      {before}\n                      <a\n                        className=\"hover:underline\"\n                        style={{ color: '#afbfff' }}\n                        href={url}\n                        target=\"_blank\"\n                        rel=\"noreferrer\"\n                      >\n                        {linkText[1]}\n                      </a>\n                      {after}\n                    </p>\n                  );\n                })}\n              </>\n            )}\n          </div>\n        )}\n        {step >= 2 && (\n          <LineGraphContainer\n            keys={keys}\n            rangeMin={question.yMin}\n            rangeMax={question.yMax}\n            series={series}\n            setSeries={nextSeries =>\n              dispatch({ type: 'setState', data: { series: nextSeries } })\n            }\n            referenceData={referenceData}\n          />\n        )}\n        <div className=\"absolute bottom-0 right-0 overflow-hidden flex items-center rounded-tl rounded-br-xl opacity-50 hover:opacity-100 bg-gray-900 text-white\">\n          {progress && (\n            <span className=\"cursor-default text-sm px-2\">{`${progress.progress} / ${progress.total}`}</span>\n          )}\n          <button\n            className=\"hover:bg-accent\"\n            style={{ padding: '0.25rem 12px 0.25rem 8px' }}\n            onClick={handleForward}\n          >\n            <Icon size={16} />\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default GuessMachine;\n","import React, { useContext, useState, useEffect } from 'react';\nimport { ArrowLeft, Settings } from 'react-feather';\nimport { ChatCompose } from './chatCompose';\nimport { ChatPanel } from './chatPanel';\nimport { ChatSettings } from './chatSettings';\nimport { navigate } from 'gatsby';\nimport { ChatContext } from './chatContext';\nimport { UserContext } from './userContext';\nimport { AccountModal } from './accountModal';\nimport GuessMachine from './guessMachine';\nimport '../../css/chat.css';\n\nfunction Chat() {\n  const { authHttp, user, userLoading } = useContext(UserContext);\n  const { isFirstLogin, setFirstLogin, roomTitle, sendMessage } = useContext(\n    ChatContext\n  );\n  const [showSettings, setShowSettings] = useState(false);\n  const [showAccountModal, setShowAccountModal] = useState(false);\n\n  useEffect(() => {\n    if (!user && !userLoading) {\n      setShowAccountModal(true);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [user, userLoading]);\n\n  useEffect(() => {\n    if (isFirstLogin) {\n      setShowSettings(true);\n      setFirstLogin(false);\n    }\n  }, [isFirstLogin, setFirstLogin]);\n\n  const handleSend = async (text, attachments) => {\n    if (text === '/guessr:refresh') {\n      if (authHttp) {\n        authHttp.get('/guessr/q/refresh').then(console.log);\n      } else {\n        console.log('guessr refresh failed - http client not initialized');\n      }\n      return;\n    }\n    const data = { text };\n    if (authHttp && attachments && attachments.length) {\n      const formdata = new FormData();\n      attachments.forEach(a => {\n        formdata.append('attachments', a);\n      });\n      const attachmentLinks = await authHttp.postForm('/imgur', formdata);\n      if (!attachmentLinks.success) {\n        console.error(attachmentLinks.message || 'Unknown error');\n        return false;\n      }\n      data.attachments = attachmentLinks.data.map(att => ({\n        type: 'imgur',\n        link: att.link,\n        tag: att.type.startsWith('image') ? 'img' : 'video',\n      }));\n    }\n    sendMessage({ action: 'chat', data });\n    return true;\n  };\n\n  const handleBack = () => {\n    navigate(`/chat`);\n  };\n\n  return (\n    <div className=\"flex flex-col h-full pt-4 pb-6\">\n      <div className=\"flex items-center border-b pb-2\">\n        <button\n          className=\"hover:bg-paper-darker text-accent p-1 mr-3 rounded-full\"\n          onClick={handleBack}\n        >\n          <ArrowLeft className=\"stroke-current\" />\n        </button>\n        <h2 className=\"mb-1\">{roomTitle || 'Loading...'}</h2>\n        <span className=\"flex-grow\"></span>\n        <button\n          className=\"hover:bg-paper-darker p-1 rounded-full\"\n          onClick={() => setShowSettings(true)}\n        >\n          <Settings className=\"stroke-current\" size={16} />\n        </button>\n      </div>\n      <GuessMachine />\n      <div className=\"flex-1 flex flex-col overflow-hidden\">\n        <ChatPanel />\n        <ChatCompose send={handleSend} />\n      </div>\n      <ChatSettings\n        showModal={showSettings}\n        closeModal={() => setShowSettings(false)}\n      />\n      <AccountModal\n        showModal={showAccountModal}\n        closeModal={() => setShowAccountModal(false)}\n        defaultTab={0}\n      />\n    </div>\n  );\n}\n\nChat.propTypes = {};\n\nexport default Chat;\n","import React, { useState, useContext, useMemo } from 'react';\nimport { navigate } from 'gatsby';\nimport { Tabs } from '../tabs';\nimport { UserContext } from './userContext';\nimport { useAsyncTask } from '../../hooks/useAsyncTask';\n\nfunction CreateForm() {\n  const { authHttp } = useContext(UserContext);\n\n  const [reqTitle, setReqTitle] = useState('');\n  const [reqNickname, setReqNickname] = useState('');\n  const [errorMessage, setErrorMessage] = useState();\n\n  const create = useAsyncTask(async (title, nickname) => {\n    if (!authHttp) return; // todo guest\n\n    const json = await authHttp.post('/g', { title, nickname });\n    if (json.success) {\n      navigate(`/chat?room=${json.conversationId}`);\n    } else {\n      setErrorMessage(json.message || 'Unknown error');\n    }\n  });\n\n  const handleCreate = ev => {\n    ev.preventDefault();\n    if (!create.loading) create.run(reqTitle, reqNickname);\n  };\n\n  return (\n    <div>\n      <form onSubmit={handleCreate} className=\"flex flex-wrap -m-1 mt-2\">\n        <input\n          name=\"title\"\n          placeholder=\"Room title\"\n          type=\"text\"\n          autoComplete=\"off\"\n          className=\"w-full sm:w-auto flex-1 bg-paper-darker hover:bg-paper-dark rounded p-2 m-1\"\n          value={reqTitle}\n          onChange={ev => {\n            setErrorMessage(undefined);\n            setReqTitle(ev.currentTarget.value);\n          }}\n        />\n        <input\n          name=\"nickname\"\n          placeholder=\"Your nickname in the room\"\n          type=\"text\"\n          autoComplete=\"off\"\n          className=\"w-full sm:w-auto flex-1 bg-paper-darker hover:bg-paper-dark rounded p-2 m-1\"\n          value={reqNickname}\n          onChange={ev => {\n            setErrorMessage(undefined);\n            setReqNickname(ev.currentTarget.value);\n          }}\n        />\n        <button\n          type=\"submit\"\n          className=\"w-full sm:w-auto bg-accent-200 hover:bg-accent text-white py-1 px-3 m-1 rounded\"\n        >\n          Go!\n        </button>\n      </form>\n      {errorMessage && <p className=\"mt-2 mb-0 text-danger\">{errorMessage}</p>}\n    </div>\n  );\n}\n\nfunction JoinForm() {\n  const [reqCode, setReqCode] = useState('');\n\n  const handleJoin = ev => {\n    ev.preventDefault();\n    navigate(`/chat?room=${reqCode}`);\n  };\n\n  return (\n    <form onSubmit={handleJoin} className=\"flex flex-wrap -m-1 mt-2\">\n      <input\n        name=\"code\"\n        placeholder=\"Enter a code\"\n        type=\"text\"\n        autoComplete=\"off\"\n        className=\"w-full sm:w-auto flex-1 bg-paper-darker hover:bg-paper-dark rounded p-2 m-1\"\n        value={reqCode}\n        onChange={ev => setReqCode(ev.currentTarget.value)}\n      />\n      <button\n        type=\"submit\"\n        className=\"w-full sm:w-auto bg-accent-200 hover:bg-accent text-white py-1 px-3 rounded m-1\"\n      >\n        Go!\n      </button>\n    </form>\n  );\n}\n\nfunction DashActions() {\n  const { user } = useContext(UserContext);\n  const [activeTab, setActiveTab] = useState(0);\n  const tabItems = useMemo(() => {\n    if (user) return ['Join', 'Create'];\n    return ['Join'];\n  }, [user]);\n  return (\n    <Tabs activeTab={activeTab} setActiveTab={setActiveTab} items={tabItems}>\n      {activeTab === 0 && <JoinForm />}\n      {activeTab === 1 && <CreateForm />}\n    </Tabs>\n  );\n}\n\nexport default DashActions;\n","import React, { useState, useContext, useEffect, useCallback } from 'react';\nimport { navigate } from 'gatsby';\nimport Table from '../table';\nimport DashActions from './dashActions';\nimport { UserContext } from './userContext';\nimport { useAsyncTask } from '../../hooks/useAsyncTask';\nimport { AccountModal } from './accountModal';\n\nfunction Dashboard({ handleOpen }) {\n  const { user, userLoading, authHttp, logout } = useContext(UserContext);\n  const [list, setList] = useState([]);\n  const getRooms = useAsyncTask(\n    useCallback(async client => {\n      const data = await client.get('/g');\n      if (data.success) setList(data.conversations);\n    }, [])\n  );\n  useEffect(() => {\n    if (user && authHttp) getRooms.run(authHttp);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [authHttp, user]);\n  const [selected, setSelected] = useState([]);\n  const withoutDeleted = selected.filter(e => list.includes(e));\n  if (withoutDeleted.length < selected.length) {\n    setSelected(withoutDeleted);\n  }\n  const handleSelect = (item, isSelected) => {\n    setSelected([...selected, item].filter(e => isSelected || e !== item));\n  };\n  const [showModal, setShowModal] = useState(false);\n  const [defaultModalTab, setDefaultModalTab] = useState(0);\n\n  return (\n    <div>\n      <DashActions />\n      <div className=\"flex items-center justify-between border-b border-paper-dark py-2 mt-8\">\n        <h3>Past rooms</h3>\n        {user && (\n          <button\n            className=\"hover:bg-paper-darker text-accent py-1 px-2 mb-1 rounded\"\n            onClick={logout}\n          >\n            <span className=\"font-bold text-sm uppercase\">Log out</span>\n          </button>\n        )}\n      </div>\n      {user || userLoading ? (\n        <Table\n          rows={list}\n          columns={[\n            {\n              field: 'title',\n              label: 'Title',\n              class: 'text-left',\n            },\n            {\n              field: 'nickname',\n              label: 'Your nickname',\n              class: 'text-left',\n            },\n          ]}\n          handleSelect={handleSelect}\n          handleOpen={item => navigate(`/chat?room=${item.id}`)}\n          keyField=\"id\"\n        />\n      ) : (\n        <p>\n          You aren't logged in. You can{' '}\n          <button\n            className=\"text-accent hover:text-accent-700 hover:underline\"\n            onClick={() => {\n              setDefaultModalTab(0);\n              setShowModal(true);\n            }}\n          >\n            create a guest account\n          </button>{' '}\n          or{' '}\n          <button\n            className=\"text-accent hover:text-accent-700 hover:underline\"\n            onClick={() => {\n              setDefaultModalTab(1);\n              setShowModal(true);\n            }}\n          >\n            sign in\n          </button>{' '}\n          if you have a previous account.\n        </p>\n      )}\n      <AccountModal\n        showModal={showModal}\n        closeModal={() => setShowModal(false)}\n        defaultTab={defaultModalTab}\n      />\n    </div>\n  );\n}\n\nDashboard.propTypes = {};\n\nexport default Dashboard;\n","import React, { useState, useEffect } from 'react';\nimport { globalHistory } from '@reach/router';\nimport Layout from '../components/layout';\nimport SEO from '../components/seo';\nimport Section from '../components/section';\nimport ScreenWrapper from '../components/screenWrapper';\nimport Chat from '../components/chat/chat';\nimport Dashboard from '../components/chat/dashboard';\nimport qs from 'querystring';\nimport { UserProvider } from '../components/chat/userContext';\n\nimport '../css/styles.css';\nimport { ChatProvider } from '../components/chat/chatContext';\n\nfunction ChatApp() {\n  const { location } = globalHistory;\n  const [roomId, setRoomId] = useState();\n\n  useEffect(() => {\n    const { room } = qs.parse(location.search.replace(/^\\?/, ''));\n    setRoomId(room);\n  }, [location.search]);\n\n  if (typeof window === 'undefined') return null;\n  if (!roomId) {\n    return (\n      <Section className=\"px-5 mt-6\">\n        <Dashboard />\n      </Section>\n    );\n  }\n  return (\n    <ScreenWrapper className=\"px-5\" innerClassName=\"container mx-auto\">\n      <ChatProvider>\n        <Chat />\n      </ChatProvider>\n    </ScreenWrapper>\n  );\n}\n\nconst ChatPage = ({ location }) => {\n  return (\n    <Layout navLinks={[{ text: 'Blog', href: '/blog' }]} hideFooter>\n      <SEO title=\"Chat\" />\n\n      <UserProvider>\n        <ChatApp />\n      </UserProvider>\n    </Layout>\n  );\n};\n\nexport default ChatPage;\n"],"sourceRoot":""}