(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{KSVO:function(n,e,t){"use strict";t.r(e);var r=t("q1tI"),i=t.n(r);t("VRzm"),t("Btvt"),t("SRfc");function s(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function a(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function o(n,e,t){return e&&a(n.prototype,e),t&&a(n,t),n}t("8+KV"),t("rGqo"),t("yt8O"),t("XfO3"),t("9AAn"),t("bWfx");function c(n){return"Expression"===n.kind?"(".concat(n.children.map(c).join(" "),")"):n.source}var u,l=new Map;l.set("LineComment",/;.*?$/m),l.set("BlockComment",/#\|.*?\|#/),l.set("ExpressionStart",/[[(]/),l.set("ExpressionEnd",/[\])]/),l.set("String",/"(?:"|(?:[^"]+?)*(?:\\\\"|[^\\]"))/),l.set("Number",/[-+]?(?:[0-9]+(?:\.?[0-9]*)?|\.[0-9]+)(?:e[-+]?[0-9]+)?/),l.set("Symbol",/'[^\][(){}|\s ,`"'#][^\][(){}|\s ,`"'#]*/),l.set("Variable",/[^\][(){}|\s ,`"'#][^\][(){}|\s ,`"'#]*/),function(n){n[n.InProgress=0]="InProgress",n[n.Done=1]="Done",n[n.FoundUnclosed=2]="FoundUnclosed",n[n.FoundTrailing=3]="FoundTrailing"}(u||(u={}));var h=function(){function n(e){s(this,n),this.code=e,this.root={kind:"Expression",children:[]},this.contextStack=[],this.context=this.root,this.status=u.InProgress}return o(n,[{key:"advance",value:function(){if(this.status!==u.InProgress)throw new Error("Parser can not advance past last context");var n,e,t,r=(n=this.code,e=!1,t=null,l.forEach((function(r,i){var s,a,o=r.exec(n);if(null!=o){var c=function(n){return{index:n.index,length:n[0].length,match:n[0]}}(o);a=c,null!=(s=t)&&(s.index<a.index||s.index===a.index&&s.length>=a.length)||(t=c,e=i)}})),!1!==e&&null!=t&&{step:e,span:t});if(!1!==r){if("ExpressionStart"===r.step){var i={kind:"Expression",children:[]};this.context.children.push(i),this.contextStack.push(this.context),this.context=i}else if("ExpressionEnd"===r.step){var s=this.contextStack.pop();if(null==s)return void(this.status=u.FoundTrailing);this.context=s}else this.context.children.push({kind:r.step,source:r.span.match});this.code=this.code.substring(r.span.index+r.span.length)}else 0===this.contextStack.length?this.status=u.Done:this.status=u.FoundUnclosed}},{key:"getLastRacketNode",value:function(){return this.context.children.length>0?this.context.children[this.context.children.length-1]:null}}]),n}();function d(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n)){var t=[],r=!0,i=!1,s=void 0;try{for(var a,o=n[Symbol.iterator]();!(r=(a=o.next()).done)&&(t.push(a.value),!e||t.length!==e);r=!0);}catch(c){i=!0,s=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return t}}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(n){return function(n){if(Array.isArray(n)){for(var e=0,t=new Array(n.length);e<n.length;e++)t[e]=n[e];return t}}(n)||function(n){if(Symbol.iterator in Object(n)||"[object Arguments]"===Object.prototype.toString.call(n))return Array.from(n)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t("dRSK"),t("f3/d"),t("dZ+Y"),t("rvZc"),t("0l/t"),t("pIFo"),t("Z2Ku"),t("L9s1");var p=t("LvDl");function g(n){if("LineComment"===n.kind&&n.source.includes(":")&&n.source.includes("->")){for(var e="(".concat(n.source.replace(/^[; ]+/,"").replace(":"," : "),")"),t=new h(e);t.status===u.InProgress;)t.advance();if(t.status===u.Done&&t.root.children.length>0){var r=t.root.children[0],i={kind:"Variable",source:"->"};if("Expression"===r.kind&&r.children.length>3&&"Variable"===r.children[0].kind&&Object(p.isMatch)(r.children[1],{kind:"Variable",source:":"})){if(1!==r.children.map((function(n,e){return Object(p.isMatch)(n,i)?e:-1})).filter((function(n){return n>=0})).length)return!1;if(r.children[0].source.endsWith("-temp")&&r.children.some((function(n){return"Variable"===n.kind&&/^\?+$/.test(n.source)})))return!1;var s={kind:"FunctionDesign",name:"",purposeLines:0,tests:0,warnings:[]};return s.name=r.children[0].source,s}}}return!1}function m(n){return"Expression"===n.kind&&Object(p.isMatch)(n.children[0],{kind:"Variable",source:"define"})&&"Variable"===n.children[1].kind&&/^[A-Z0-9-]+$/.test(n.children[1].source)}function v(n){return"Variable"===n.kind?/^\.{2,6}$/.test(n.source):"Expression"===n.kind&&null!=n.children.find(v)}var b=["check-expect","check-random","check-satisfied","check-within","check-error","check-member-of","check-range"];function k(n){return!!("Expression"===n.kind&&n.children.length>=3&&"Variable"===n.children[0].kind&&b.includes(n.children[0].source))&&{actual:n.children[1]}}function y(n,e){var t={calls:[],stop:!1},r=0;if("Variable"===n.children[0].kind){var i={name:n.children[0].source,body:n};if(t.calls.push(i),t.stop=e(i),t.stop)return t;r=1}for(var s=r;s<n.children.length;s++){var a=n.children[s];if("Expression"===a.kind){var o,c=y(a,e);if((o=t.calls).push.apply(o,f(c.calls)),t.stop=c.stop,t.stop)return t}}return t}function w(n,e){if("Expression"!==n.kind)return null;var t=y(n,e);return t.stop&&0!==t.calls.length?t.calls[t.calls.length-1]:null}function x(n){if("Expression"===n.kind&&3===n.children.length&&Object(p.isMatch)(n.children[0],{kind:"Variable",source:"define"})&&"Expression"===n.children[1].kind&&n.children[1].children.length>0){for(var e=n.children[1],t=0;t<e.children.length;t++)if("Variable"!==e.children[t].kind)return!1;var r=e.children.map((function(n){return n.source}));return{name:r[0],argNames:r.slice(1),isTemplate:v(n),body:n.children[2]}}return!1}var E=function(){function n(e,t){s(this,n),this.actionArg=e(),!1!==this.actionArg?this.result=t(this.actionArg):this.result=!1}return o(n,[{key:"or",value:function(e,t){return!1!==this.actionArg?this:new n(e,t)}}]),n}(),S=function(){function n(e,t){s(this,n),this.remainingNodes=e,this.messages=[{kind:"General",warnings:[]}],this.templates=[],this.testThreshold=2,null!=t&&null!=t.testThreshold&&(this.testThreshold=t.testThreshold)}return o(n,[{key:"requireCurrentFunctionDesign",value:function(){var n=this.messages[this.messages.length-1];if("FunctionDesign"!==n.kind)throw new Error("The warning list at the current position is not a FunctionDesign");return n}},{key:"getOutputWarningLists",value:function(){return this.messages.filter((function(n){return n.warnings.length>0})).map((function(n){return{kind:"Output",title:"FunctionDesign"===n.kind?"In function design for ".concat(n.name):"Before first function design",warnings:n.warnings}}))}},{key:"lint",value:function(){for(;this.remainingNodes.length>0;)this.addSignature(),this.remainingNodes.length>0&&(this.addPurposeLines(),this.addTests(),this.finalize(this.requireCurrentFunctionDesign()));return this.getOutputWarningLists()}},{key:"finalize",value:function(n){n.purposeLines<1&&n.warnings.push("no purpose statement"),n.tests<this.testThreshold&&n.warnings.push("only ".concat(n.tests," tests"))}},{key:"getBodyWarnings",value:function(e){var t,r="Expression"!==(t=e.body).kind?[]:y(t,(function(){return!1})).calls,i=[];return r.filter((function(n){return"local"===n.name})).forEach((function(e,t){if(e.body.children.length>=2&&"Expression"===e.body.children[1].kind){var r=new n(e.body.children[1].children.slice(),{testThreshold:0});r.lint(),r.messages.filter((function(n){return n.warnings.length>0})).forEach((function(n){i.push.apply(i,f(n.warnings.map((function(e){var t=e.replace(/^within local .*: /,"");return"FunctionDesign"===n.kind?"within local def of ".concat(n.name,": ").concat(t):"within local: ".concat(t)}))))}))}})),i}},{key:"addSignature",value:function(){for(var n=this,e=function(){var e=d(n.remainingNodes.splice(0,1),1)[0],t=n.messages[n.messages.length-1],r=g(e);if(!1!==r)return n.messages.push(r),{v:void 0};new E((function(){return x(e)}),(function(e){var r;e.isTemplate?n.templates.push(e):(t.warnings.push("unexpected function definition for ".concat(e.name)),(r=t.warnings).push.apply(r,f(n.getBodyWarnings(e))))})).or((function(){return k(e)}),(function(n){t.warnings.push("unexpected test: ".concat(c(e)))}))};this.remainingNodes.length>0;){var t=e();if("object"==typeof t)return t.v}}},{key:"addPurposeLines",value:function(){for(var n=this.requireCurrentFunctionDesign();this.remainingNodes.length>0;){var e=this.remainingNodes[0];if("LineComment"===e.kind||"BlockComment"===e.kind)n.purposeLines+=1,this.remainingNodes.splice(0,1);else{if(!m(e))return;this.remainingNodes.splice(0,1)}}}},{key:"addTests",value:function(){for(var n=this,e=this.requireCurrentFunctionDesign(),t=function(){var t=n.remainingNodes[0];if(!1!==g(t))return{v:void 0};n.remainingNodes.splice(0,1),new E((function(){return x(t)}),(function(t){var r;t.isTemplate?n.templates.push(t):(null!=w(t.body,(function(n){return"big-bang"===n.name}))&&(e.tests=1e3),t.name!==e.name&&e.warnings.push("unexpected function definition for ".concat(t.name)),(r=e.warnings).push.apply(r,f(n.getBodyWarnings(t))))})).or((function(){return k(t)}),(function(n){e.tests+=1,null==w(n.actual,(function(n){return n.name===e.name}))&&e.warnings.push("expected test to call ".concat(e.name,": ").concat(c(t)))}))};this.remainingNodes.length>0;){var r=t();if("object"==typeof r)return r.v}}}],[{key:"fromParser",value:function(e){if(e.status!==u.Done)throw new Error("Can't create linter for unfinished parser");return new n(e.root.children.slice())}}]),n}();function N(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function F(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var T=function(n){function e(e){var t;return(t=n.call(this,e)||this).state={value:""},t.handleSubmit=t.handleSubmit.bind(N(t)),t}F(e,n);var t=e.prototype;return t.handleSubmit=function(){this.props.doSubmit(this.state.value)},t.render=function(){var n=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,i.a.createElement("textarea",{onChange:function(e){return n.setState({value:e.target.value})},className:"w-full font-mono text-sm leading-tight border-2 border-paper-dark focus:border-accent-200 p-2 placeholder-pen-light bg-paper",placeholder:"Paste code from DrRacket",spellCheck:!1,style:{height:"25rem"}})),i.a.createElement("button",{className:"bg-accent-200 hover:bg-accent text-white py-2 px-4 rounded",type:"submit",onClick:this.handleSubmit},"Check"))},e}(r.PureComponent),A=function(n){function e(e){var t;return(t=n.call(this,e)||this).state={warningGroups:!1,error:!1},t.doLint=t.doLint.bind(N(t)),t}F(e,n);var t=e.prototype;return t.doLint=function(n){var e,t=this;(e=n,new Promise((function(n,t){for(var r=new h(e);r.status===u.InProgress;)r.advance();r.status===u.Done?n(S.fromParser(r).lint()):r.status===u.FoundTrailing?t("Syntax error in file: trailing characters"):r.status===u.FoundUnclosed?t("Syntax error in file: unmatched parenthesis or bracket"):t("Unknown error")}))).then((function(n){t.setState({warningGroups:n,error:!1})}),(function(n){t.setState({warningGroups:!1,error:n})}))},t.render=function(){var n=null;if(!1!==this.state.error)n=i.a.createElement("div",{className:"mt-4"},i.a.createElement("em",{className:"font-bold text-danger"},this.state.error));else if(Array.isArray(this.state.warningGroups)){var e=this.state.warningGroups.length;n=i.a.createElement("div",{className:"mt-4"},i.a.createElement("h3",null,0===e?"0 warnings":"Warnings"),this.state.warningGroups.map((function(n,e){var t=n.title,r=n.warnings;return i.a.createElement("details",{className:"mb-4",open:!0,key:e},i.a.createElement("summary",{className:"p-1 bg-paper-darker cursor-pointer"},t),r.map((function(n,e){return i.a.createElement("p",{className:"ml-6 mb-0 text-sm font-mono",key:e},n)})))})))}return i.a.createElement("div",{className:this.props.className},i.a.createElement(T,{doSubmit:this.doLint}),n)},e}(i.a.Component);A.defaultProps={className:""};e.default=A}}]);
//# sourceMappingURL=8-6b39ccebb77cd728cd0f.js.map